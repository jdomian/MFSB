let camera;document.addEventListener("DOMContentLoaded",function(e){mfsb.init(),mfsb.crossHairType(),console.log("init loaded"),camera=$("#camera-wrapper"),$("[data-nav-to]").on("touchend",e=>{let t=e.target.dataset.navTo;console.log(t),$("#main-info-text").text(t),$("[data-nav]").removeClass("active"),$(".arc").removeClass("in"),$("[data-nav="+t+"]").addClass("active").children(".arc").addClass("in"),$(".arc").removeClass("active")})});var App=()=>(function(){console.log("app start"),alert("hi")});const socket={local:io()},stream=document.getElementById("stream"),trackingCanvas=document.getElementById("tracking-canvas"),base64Canvas=document.getElementById("base64-canvas");let tensorFlow,mfsb={cameraZoomLevel:1,init(){console.log("Mutha Fuckin Space Blaster Initialized."),mfsb.crossHairType()},zoomIn(){let e=2*this.cameraZoomLevel;this.cameraZoomLevel=e,camera.css("transform","scale("+e+", "+e+")")},zoomOut(){let e=this.cameraZoomLevel/2;e<1&&(e=1),this.cameraZoomLevel=e,camera.css("transform","scale("+e+", "+e+")")},crossHairType(e){let t=localStorage.getItem("crosshair-type");null===t||void 0===e?localStorage.setItem("crosshair-type","standard"):localStorage.setItem("crosshair-type",e),t=localStorage.getItem("crosshair-type"),$(".crosshair").hide(),$("#crosshair > #"+t).show()},ml5AIDetect(){let e,t=ml5.objectDetector("MobileNet",{},function(){let a=$("#debug-ai");e=setInterval(()=>{t.detect(stream,(e,t)=>{console.log(t),void 0!==t&&a.text(t[0].label,t[0].height,t[0].width)})},2e3)})},accelerometerStart(){let e=0;socket.local.emit("startAccelerometer",!0),$("#debug-accel").text("Starting Accelerometer..."),socket.local.on("accelerometer",t=>{let a=t.split(","),o=Math.round(2*a[0])/2,r=Math.round(2*a[1])/2,s=a[2],c=-10*o,n=-9*r;$("#accel-Y-line").css("transform","translate(0,"+c+"vh)"),$("#accel-X-line").css("transform","translate("+n+"vw, 0vh)"),$("#accel-X-line").css("transform","rotate("+n+"deg)"),(c>0&&10*s-10*o<100||c<0&&10*s-10*o>100)&&(console.log("Fired!"),$("#debug-accel").text("Fired!")),e=c})},accelerometerStop(){console.log("Stopping accelerometer reading"),$("#debug-accel").text("Accelerometer Stopped."),socket.local.emit("stopAccelerometer",!0)},accelerometerPin(){let e=$(".accel-line").detach();$("#pinned > #accelerometer").html(e)},tensorFlowStart(){let e=this;$("#debug-ai").text("AI Started...");tensorFlow=setInterval(()=>{socket.server.emit("stream",(()=>e.convertToBase64())())},1e3),socket.server.on("AIIdentified",e=>{console.log(e);let t=e[0].bbox[0],a=e[0].bbox[1],o=e[0].bbox[2],r=e[0].bbox[3],s=e[0].class,c=e[0].score;$("#debug-ai").text(s+" --- "+Math.round(100*c)+"%"),$("#TFTarget").css({top:a,left:t,height:r,width:o})})},tensorFlowStop(){clearInterval(tensorFlow),$("#debug-ai").text("AI Stopped"),console.log("test")},trackAndRenderLocal(){const e=document.getElementById("stream");this.renderBox([200,200,200,200]);const t=objectTracker.init(e,[200,200,200,200]);setInterval(async()=>{let e=document.getElementById("stream"),a=await t.next(e);console.log(a),mfsb.renderBox(a)},100)},trackAndRenderLocalAjax(){const e=document.getElementById("stream");this.renderBox([200,200,200,200]);const t=objectTracker.init(e,[200,200,200,200]);setInterval(async()=>{let e=document.getElementById("stream"),a=await t.next(e);console.log(a),mfsb.renderBox(a)},100)},trackAndRenderLocalWorker(){const e=document.getElementById("stream"),t=objectTracker.init(e,[200,200,200,200]);socket.local.emit("track",t)},trackAndRender(){const e=this;e.renderBox([180,180,120,120]),setInterval(async()=>{let t=await e.convertToBase64(),a=new Date,o=a.getHours()+":"+a.getMinutes()+":"+a.getSeconds();console.log("["+o+"]Image converted... sending."),await socket.server.emit("track",t)},0),socket.server.on("objectTracker",e=>{this.renderBox(e)})},lockTarget(){socket.server.emit("lock-target",[180,180,120,120]),socket.server.emit("lock-target-profile",this.convertToBase64()),this.renderBox([180,180,120,120])},renderBox(e){trackingCanvas.width=480,trackingCanvas.height=480;let t=trackingCanvas.getContext("2d");t.clearRect(0,0,t.canvas.width,t.canvas.height),t.lineWidth=2,t.strokeStyle="yellow",t.strokeRect(e[0],e[1],e[2],e[3])},convertImageToCanvas(){base64Canvas.width=stream.width,base64Canvas.height=stream.height;const e=base64Canvas.getContext("2d");return e.drawImage(stream,0,0),e},convertToBase64:()=>(base64Canvas.width=stream.width,base64Canvas.height=stream.height,base64Canvas.getContext("2d").drawImage(stream,0,0),base64Canvas.toDataURL("data:image/jpg;charset=utf-8;base64,",.1)),sudoReboot(){socket.local.emit("sudoReboot",!0)},sudoShutdown(){socket.local.emit("sudoShutdown",!0)}};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdHMuanMiXSwibmFtZXMiOlsiY2FtZXJhIiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJtZnNiIiwiaW5pdCIsImNyb3NzSGFpclR5cGUiLCJjb25zb2xlIiwibG9nIiwiJCIsIm9uIiwiZSIsImRlc3RpbmF0aW9uIiwidGFyZ2V0IiwiZGF0YXNldCIsIm5hdlRvIiwidGV4dCIsInJlbW92ZUNsYXNzIiwiYWRkQ2xhc3MiLCJjaGlsZHJlbiIsIkFwcCIsImFsZXJ0Iiwic29ja2V0IiwibG9jYWwiLCJpbyIsInN0cmVhbSIsImdldEVsZW1lbnRCeUlkIiwidHJhY2tpbmdDYW52YXMiLCJiYXNlNjRDYW52YXMiLCJ0ZW5zb3JGbG93IiwiY2FtZXJhWm9vbUxldmVsIiwiW29iamVjdCBPYmplY3RdIiwiem9vbSIsInRoaXMiLCJjc3MiLCJ0eXBlIiwiY3Jvc3NoYWlyVHlwZVNhdmVkIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsInVuZGVmaW5lZCIsInNldEl0ZW0iLCJoaWRlIiwic2hvdyIsImRldGVjdG9yIiwib2JqZWN0RGV0ZWN0b3IiLCJtbDUiLCJkZWJ1ZyIsInNldEludGVydmFsIiwiZGV0ZWN0IiwiZXJyIiwicmVzdWx0cyIsImxhYmVsIiwiaGVpZ2h0Iiwid2lkdGgiLCJwcmV2aW91c0RhdGFZIiwiZW1pdCIsImFyZyIsImRhdGEiLCJzcGxpdCIsImRhdGFZIiwiTWF0aCIsInJvdW5kIiwiZGF0YVgiLCJkYXRhWiIsImRhdGFZUG9zaXRpb24iLCJkYXRhWFBvc2l0aW9uIiwiYWNjZWwiLCJkZXRhY2giLCJodG1sIiwic2VsZiIsInNlcnZlciIsImNvbnZlcnRUb0Jhc2U2NCIsImdldEZyYW1lIiwibGVmdCIsImJib3giLCJ0b3AiLCJvYmpDbGFzcyIsImNsYXNzIiwic2NvcmUiLCJjbGVhckludGVydmFsIiwiZnJhbWUiLCJyZW5kZXJCb3giLCJ0cmFja2VyIiwib2JqZWN0VHJhY2tlciIsImFzeW5jIiwiZnJhbWUyIiwiYm94MiIsIm5leHQiLCJpbWciLCJ0b2RheSIsIkRhdGUiLCJub3ciLCJnZXRIb3VycyIsImdldE1pbnV0ZXMiLCJnZXRTZWNvbmRzIiwiYm94IiwiY3R4IiwiZ2V0Q29udGV4dCIsImNsZWFyUmVjdCIsImNhbnZhcyIsImxpbmVXaWR0aCIsInN0cm9rZVN0eWxlIiwic3Ryb2tlUmVjdCIsImRyYXdJbWFnZSIsInRvRGF0YVVSTCJdLCJtYXBwaW5ncyI6IkFBRUEsSUFBSUEsT0FDSkMsU0FBU0MsaUJBQWlCLG1CQUFvQixTQUFTQyxHQUVuREMsS0FBS0MsT0FDTEQsS0FBS0UsZ0JBQ0xDLFFBQVFDLElBQUksZUFDWlIsT0FBU1MsRUFBRSxtQkFRWEEsRUFBRSxpQkFBaUJDLEdBQUcsV0FBYUMsSUFDL0IsSUFBSUMsRUFBY0QsRUFBRUUsT0FBT0MsUUFBUUMsTUFFbkNSLFFBQVFDLElBQUlJLEdBQ1pILEVBQUUsbUJBQW1CTyxLQUFLSixHQUUxQkgsRUFBRSxjQUFjUSxZQUFZLFVBQzVCUixFQUFFLFFBQVFRLFlBQVksTUFDdEJSLEVBQUUsYUFBZUcsRUFBYyxLQUFLTSxTQUFTLFVBQVVDLFNBQVMsUUFBUUQsU0FBUyxNQUNqRlQsRUFBRSxRQUFRUSxZQUFZLGNBeUI5QixJQUFJRyxJQUFNLEtBQU0sV0FDWmIsUUFBUUMsSUFBSSxhQUNaYSxNQUFNLFFBSVYsTUFBTUMsT0FBUyxDQUNYQyxNQUFPQyxNQUtMQyxPQUFTeEIsU0FBU3lCLGVBQWUsVUFDakNDLGVBQWlCMUIsU0FBU3lCLGVBQWUsbUJBQ3pDRSxhQUFlM0IsU0FBU3lCLGVBQWUsaUJBQzdDLElBQUlHLFdBR0F6QixLQUFPLENBQ1AwQixnQkFBaUIsRUFDakJDLE9BQ0l4QixRQUFRQyxJQUFJLDJDQUNaSixLQUFLRSxpQkFFVHlCLFNBQ0ksSUFBSUMsRUFBOEIsRUFBdkJDLEtBQUtILGdCQUNoQkcsS0FBS0gsZ0JBQWtCRSxFQUN2QmhDLE9BQU9rQyxJQUFJLFlBQWEsU0FBV0YsRUFBTyxLQUFPQSxFQUFPLE1BRTVERCxVQUNJLElB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QUlIbEUsT0FBT2dELE9BQU81RCxHQUFHLGdCQUFrQndFLElBQy9CakQsS0FBS2dELFVBQVVDLE1BR3ZCbkQsYUFPSVQsT0FBT2dELE9BQU9mLEtBQUssY0FBZSxDQUxyQixJQUNBLElBQ0MsSUFDQyxNQUdmakMsT0FBT2dELE9BQU9mLEtBQUssc0JBUFJ0QixLQU9vQ3NDLG1CQVBwQ3RDLEtBU05nRCxVQUFVLENBUkYsSUFDQSxJQUNDLElBQ0MsT0FPbkJsRCxVQUFVZ0UsR0FDTnBFLGVBQWUwQixNQUFRLElBQ3ZCMUIsZUFBZXlCLE9BQVMsSUFDeEIsSUFBSTRDLEVBQU1yRSxlQUFlc0UsV0FBVyxNQUNwQ0QsRUFBSUUsVUFBVSxFQUFHLEVBQUdGLEVBQUlHLE9BQU85QyxNQUFPMkMsRUFBSUcsT0FBTy9DLFFBQ2pENEMsRUFBSUksVUFBWSxFQUNoQkosRUFBSUssWUFBYyxTQUNsQkwsRUFBSU0sV0FBV1AsRUFBSSxHQUFJQSxFQUFJLEdBQUlBLEVBQUksR0FBSUEsRUFBSSxLQUcvQ2hFLHVCQUNJSCxhQUFheUIsTUFBUTVCLE9BQU80QixNQUM1QnpCLGFBQWF3QixPQUFTM0IsT0FBTzJCLE9BRTdCLE1BQU00QyxFQUFNcEUsYUFBYXFFLFdBQVcsTUFJcEMsT0FGQUQsRUFBSU8sVUFBVTlFLE9BQVEsRUFBRyxHQUVsQnVFLEdBRVh6QixnQkFBZSxLQUVYM0MsYUFBYXlCLE1BQVE1QixPQUFPNEIsTUFDNUJ6QixhQUFhd0IsT0FBUzNCLE9BQU8yQixPQUVqQnhCLGFBQWFxRSxXQUFXLE1BRWhDTSxVQUFVOUUsT0FBUSxFQUFHLEdBRVpHLGFBQWE0RSxVQUFVLHVDQUF3QyxLQUloRnpFLGFBRUlULE9BQU9DLE1BQU1nQyxLQUFLLGNBQWMsSUFFcEN4QixlQUNJVCxPQUFPQyxNQUFNZ0MsS0FBSyxnQkFBZ0IiLCJzb3VyY2VzQ29udGVudCI6WyIvKioqKioqKioqKioqKioqKioqKiogaW5pdC5qcyAqKioqKioqKioqKioqKioqKioqKi9cblxubGV0IGNhbWVyYTtcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGZ1bmN0aW9uKGV2ZW50KSB7IFxuXG4gICAgbWZzYi5pbml0KCk7XG4gICAgbWZzYi5jcm9zc0hhaXJUeXBlKCk7XG4gICAgY29uc29sZS5sb2coJ2luaXQgbG9hZGVkJyk7XG4gICAgY2FtZXJhID0gJCgnI2NhbWVyYS13cmFwcGVyJyk7XG5cbiAgICAvLyAkKCcjYXBwJykuY2xpY2soZnVuY3Rpb24oKXtcbiAgICAvLyAgICAgLy8kKHRoaXMpLmFkZENsYXNzKCdtZW51Jyk7XG4gICAgLy8gICAgIC8vJCgnLmFyYycpLnRvZ2dsZUNsYXNzKCdpbicpO1xuICAgIC8vIH0pO1xuXG5cbiAgICAkKCdbZGF0YS1uYXYtdG9dJykub24oJ3RvdWNoZW5kJywgKGUpID0+IHtcbiAgICAgICAgbGV0IGRlc3RpbmF0aW9uID0gZS50YXJnZXQuZGF0YXNldC5uYXZUbztcblxuICAgICAgICBjb25zb2xlLmxvZyhkZXN0aW5hdGlvbik7XG4gICAgICAgICQoJyNtYWluLWluZm8tdGV4dCcpLnRleHQoZGVzdGluYXRpb24pO1xuXG4gICAgICAgICQoJ1tkYXRhLW5hdl0nKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICQoJy5hcmMnKS5yZW1vdmVDbGFzcygnaW4nKTtcbiAgICAgICAgJCgnW2RhdGEtbmF2PScgKyBkZXN0aW5hdGlvbiArICddJykuYWRkQ2xhc3MoJ2FjdGl2ZScpLmNoaWxkcmVuKCcuYXJjJykuYWRkQ2xhc3MoJ2luJyk7XG4gICAgICAgICQoJy5hcmMnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgIFxuICAgIH0pO1xuXG4gICAgLy8gdmFyIHZpZGVvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN2aWRlb0VsZW1lbnRcIik7XG5cbiAgICAvLyBpZiAobmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEpIHtcbiAgICAvLyBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSh7IHZpZGVvOiB0cnVlIH0pXG4gICAgLy8gICAgIC50aGVuKGZ1bmN0aW9uIChzdHJlYW0pIHtcbiAgICAvLyAgICAgdmlkZW8uc3JjT2JqZWN0ID0gc3RyZWFtO1xuICAgIC8vICAgICB9KVxuICAgIC8vICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycjByKSB7XG4gICAgLy8gICAgIGNvbnNvbGUubG9nKFwiU29tZXRoaW5nIHdlbnQgd3JvbmchXCIpO1xuICAgIC8vICAgICB9KTtcbiAgICAvLyB9XG5cbiAgICAvLyAkKCcuYXJjJykuY2xpY2soZnVuY3Rpb24oZSl7XG4gICAgLy8gICAgIGNvbnNvbGUubG9nKGUpO1xuICAgIC8vIH0pO1xuXG5cbn0pO1xuXG4vKioqKioqKioqKioqKioqKioqKiogYXBwLmpzICoqKioqKioqKioqKioqKioqKioqL1xuXG52YXIgQXBwID0gKCkgPT4gZnVuY3Rpb24oKSB7XG4gICAgY29uc29sZS5sb2coJ2FwcCBzdGFydCcpO1xuICAgIGFsZXJ0KCdoaScpO1xufVxuXG4vL2xldCB3b3JrZXIgPSBuZXcgV29ya2VyKCdteVdvcmtlci5qcycsIHsgdHlwZTogJ21vZHVsZSd9KTtcbmNvbnN0IHNvY2tldCA9IHtcbiAgICBsb2NhbDogaW8oKVxuICAgIC8vc2VydmVyOiBpbygnd3M6Ly8xMC4wLjEwLjEwMDozMDAwJylcbn1cbi8vIGNvbnN0IHNvY2tldExvY2FsID0gaW8oKTtcbi8vIGNvbnN0IHNvY2tldCA9IGlvKCd3czovLzEwLjAuMTAuMTAwOjMwMDAnKTtcbmNvbnN0IHN0cmVhbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHJlYW0nKTtcbmNvbnN0IHRyYWNraW5nQ2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RyYWNraW5nLWNhbnZhcycpO1xuY29uc3QgYmFzZTY0Q2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Jhc2U2NC1jYW52YXMnKTtcbmxldCB0ZW5zb3JGbG93O1xuLy9sZXQgc29ja2V0ID0gaW8oKTtcblxubGV0IG1mc2IgPSB7XG4gICAgY2FtZXJhWm9vbUxldmVsOiAxLFxuICAgIGluaXQoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdNdXRoYSBGdWNraW4gU3BhY2UgQmxhc3RlciBJbml0aWFsaXplZC4nKTtcbiAgICAgICAgbWZzYi5jcm9zc0hhaXJUeXBlKCk7XG4gICAgfSxcbiAgICB6b29tSW4oKSB7XG4gICAgICAgIGxldCB6b29tID0gdGhpcy5jYW1lcmFab29tTGV2ZWwgKiAyO1xuICAgICAgICB0aGlzLmNhbWVyYVpvb21MZXZlbCA9IHpvb207XG4gICAgICAgIGNhbWVyYS5jc3MoJ3RyYW5zZm9ybScsICdzY2FsZSgnICsgem9vbSArICcsICcgKyB6b29tICsgJyknKTtcbiAgICB9LFxuICAgIHpvb21PdXQoKSB7XG4gICAgICAgIGxldCB6b29tID0gdGhpcy5jYW1lcmFab29tTGV2ZWwgLyAyO1xuICAgICAgICBpZiAoem9vbSA8IDEpIHtcbiAgICAgICAgICAgIHpvb20gPSAxO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2FtZXJhWm9vbUxldmVsID0gem9vbTtcbiAgICAgICAgY2FtZXJhLmNzcygndHJhbnNmb3JtJywgJ3NjYWxlKCcgKyB6b29tICsgJywgJyArIHpvb20gKyAnKScpO1xuICAgIH0sXG4gICAgY3Jvc3NIYWlyVHlwZSh0eXBlKSB7XG4gICAgICAgIGxldCBjcm9zc2hhaXJUeXBlU2F2ZWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY3Jvc3NoYWlyLXR5cGUnKTtcblxuICAgICAgICBpZiAoY3Jvc3NoYWlyVHlwZVNhdmVkID09PSBudWxsIHx8IHR5cGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2Nyb3NzaGFpci10eXBlJywgJ3N0YW5kYXJkJyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnY3Jvc3NoYWlyLXR5cGUnLCB0eXBlKTtcbiAgICAgICAgfVxuICAgICAgICBjcm9zc2hhaXJUeXBlU2F2ZWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY3Jvc3NoYWlyLXR5cGUnKTtcblxuICAgICAgICBcbiAgICAgICAgJCgnLmNyb3NzaGFpcicpLmhpZGUoKTtcbiAgICAgICAgJCgnI2Nyb3NzaGFpciA+ICMnICsgY3Jvc3NoYWlyVHlwZVNhdmVkKS5zaG93KCk7XG4gICAgfSxcbiAgICBtbDVBSURldGVjdCgpIHtcbiAgICAgICAgLy9jb25zdCB2aWRlbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHJlYW0nKTtcbiAgICAgICAgLy8gY29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGVjdGlvbi1vdmVybGF5Jyk7XG4gICAgICAgIC8vIGxldCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgbGV0IGRldGVjdG9yO1xuICAgICAgICBsZXQgb2JqZWN0RGV0ZWN0b3IgPSBtbDUub2JqZWN0RGV0ZWN0b3IoJ01vYmlsZU5ldCcsIHt9LCBkZXRlY3RPYmplY3RzKTtcbiAgICAgICAgXG4gICAgICAgIC8vIGNvbnN0IGxvb3AgPSBjbGFzc2lmaWVyID0+IHtcbiAgICAgICAgLy8gICAgIGNsYXNzaWZpZXIuY2xhc3NpZnkoKS50aGVuKHJlc3VsdHMgPT4ge1xuICAgICAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdHMpO1xuICAgICAgICAvLyAgICAgICAgIGxvb3AoY2xhc3NpZmllcik7IC8vIENhbGwgYWdhaW4gdG8gY3JlYXRlIGEgbG9vcFxuICAgICAgICAvLyAgICAgfSk7XG4gICAgICAgIC8vIH07XG4gICAgICAgIFxuICAgICAgICAvLyBjb25zdCBsb29wZXIgPSBkZXRlY3RvciA9PiB7XG4gICAgICAgIC8vICAgICBvYmplY3REZXRlY3Rvci5kZXRlY3QodmlkZW8sIChlcnIsIHJlc3VsdHMpID0+IHtcbiAgICAgICAgLy8gICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHRzKTtcbiAgICAgICAgLy8gICAgICAgICBkcmF3KCk7XG4gICAgICAgIC8vICAgICAgICAgbG9vcGVyKGRldGVjdG9yKTsgLy8gQ2FsbCBhZ2FpbiB0byBjcmVhdGUgYSBsb29wXG4gICAgICAgIC8vICAgICB9KTtcbiAgICAgICAgLy8gfTtcbiAgICAgICAgXG4gICAgICAgIC8vIGZ1bmN0aW9uIHN0YXJ0RGV0ZWN0aW5nKCkge1xuICAgICAgICAvLyAgICAgY29uc29sZS5sb2coJ21vZGVsIHJlYWR5Jyk7XG4gICAgICAgIC8vICAgICBkZXRlY3QoKTtcbiAgICAgICAgLy8gfVxuICAgICAgICBcbiAgICAgICAgLy8gZnVuY3Rpb24gZGV0ZWN0KCkge1xuICAgICAgICAvLyAgICAgb2JqZWN0RGV0ZWN0b3IuZGV0ZWN0KHZpZGVvLCAoZXJyLCByZXN1bHRzKSA9PiB7XG4gICAgICAgIC8vICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0cyk7IC8vIFdpbGwgb3V0cHV0IGJvdW5kaW5nIGJveGVzIG9mIGRldGVjdGVkIG9iamVjdHNcbiAgICAgICAgLy8gICAgIH0pO1xuICAgICAgICAvLyB9XG4gICAgICAgIFxuXG4gICAgICAgIGZ1bmN0aW9uIGRyYXdDU1Mob2JqZWN0cykge1xuXG4gICAgICAgICAgICBsZXQgc3R5bGVzID0gJyc7XG4gICAgICAgICAgICB2YXIgbGFiZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIlRGVGFyZ2V0TGFiZWxcIik7XG4gICAgICAgICAgXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9iamVjdHMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICBcbiAgICAgICAgICAgICAgbGFiZWwuaW5uZXJUZXh0ID0gb2JqZWN0c1tpXS5sYWJlbDtcbiAgICAgICAgICAgICAgbGFiZWwuY2xhc3NMaXN0LnJlbW92ZShcImxvY2F0aW5nXCIpO1xuICAgICAgICAgIFxuICAgICAgICAgICAgICBzdHlsZXMgPSB7XG4gICAgICAgICAgICAgICAgJ3dpZHRoJzogb2JqZWN0c1tpXS53aWR0aCArICdweCcsXG4gICAgICAgICAgICAgICAgJ2hlaWdodCc6IG9iamVjdHNbaV0uaGVpZ2h0ICsgJ3B4JyxcbiAgICAgICAgICAgICAgICAndG9wJzogb2JqZWN0c1tpXS55ICsgMTYgKyAncHgnLFxuICAgICAgICAgICAgICAgICdsZWZ0Jzogb2JqZWN0c1tpXS54ICsgNCArICdweCdcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAgIHZhciBvYmogPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIlRGVGFyZ2V0XCIpO1xuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihvYmouc3R5bGUsIHN0eWxlcyk7IFxuICAgICAgICAgIH1cbiAgICAgICAgICBcblxuICAgICAgICBmdW5jdGlvbiBkZXRlY3RPYmplY3RzKCkge1xuICAgICAgICAgICAgbGV0IGRlYnVnID0gJCgnI2RlYnVnLWFpJyk7XG4gICAgICAgICAgICBkZXRlY3RvciA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgICAgICAgICBvYmplY3REZXRlY3Rvci5kZXRlY3Qoc3RyZWFtLCAoZXJyLCByZXN1bHRzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBvYmplY3RzID0gcmVzdWx0cztcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHRzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlYnVnLnRleHQocmVzdWx0c1swXS5sYWJlbCwgcmVzdWx0c1swXS5oZWlnaHQsIHJlc3VsdHNbMF0ud2lkdGgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvL2RyYXdDU1Mob2JqZWN0cyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LDIwMDApXG4gICAgICAgIH1cblxuICAgIH0sXG4gICAgYWNjZWxlcm9tZXRlclN0YXJ0KCkge1xuICAgICAgICAvL2xldCBzb2NrZXQgPSBpbygpO1xuICAgICAgICBsZXQgcHJldmlvdXNEYXRhWSA9IDA7XG4gICAgICAgIHNvY2tldC5sb2NhbC5lbWl0KCdzdGFydEFjY2VsZXJvbWV0ZXInLCB0cnVlKTtcbiAgICAgICAgLy9zb2NrZXQuZW1pdCgnc3RhcnRBY2NlbGVyb21ldGVyJywgdHJ1ZSk7XG4gICAgICAgICQoJyNkZWJ1Zy1hY2NlbCcpLnRleHQoJ1N0YXJ0aW5nIEFjY2VsZXJvbWV0ZXIuLi4nKTtcbiAgICAgICAgc29ja2V0LmxvY2FsLm9uKCdhY2NlbGVyb21ldGVyJywgKGFyZykgPT4ge1xuICAgICAgICAgICAgbGV0IGRhdGEgPSBhcmcuc3BsaXQoJywnKTtcbiAgICAgICAgICAgIGxldCBkYXRhWSA9IE1hdGgucm91bmQoZGF0YVswXSoyKS8yO1xuICAgICAgICAgICAgbGV0IGRhdGFYID0gTWF0aC5yb3VuZChkYXRhWzFdKjIpLzI7XG4gICAgICAgICAgICBsZXQgZGF0YVogPSBkYXRhWzJdO1xuXG4gICAgICAgICAgICBsZXQgZGF0YVlQb3NpdGlvbiA9IChkYXRhWSAqIC0xMCk7XG4gICAgICAgICAgICBsZXQgZGF0YVhQb3NpdGlvbiA9IGRhdGFYICogLTk7XG5cblxuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhkYXRhWSAvIGRhdGFYKTtcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coKGRhdGFaICogMTApIC0gKGRhdGFZICogMTApKTtcbiAgICAgICAgICAgIC8vJCgnI2RlYnVnLWFjY2VsJykudGV4dCgnWTogJyArIGRhdGFZICsgJywgWDogJyArIGRhdGFYICsgJywgWjonICsgZGF0YVopO1xuICAgICAgICAgICAgJCgnI2FjY2VsLVktbGluZScpLmNzcygndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgwLCcgKyBkYXRhWVBvc2l0aW9uICsgJ3ZoKScpO1xuICAgICAgICAgICAgJCgnI2FjY2VsLVgtbGluZScpLmNzcygndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgnICsgZGF0YVhQb3NpdGlvbiArICd2dywgMHZoKScpO1xuICAgICAgICAgICAgJCgnI2FjY2VsLVgtbGluZScpLmNzcygndHJhbnNmb3JtJywgJ3JvdGF0ZSgnICsgZGF0YVhQb3NpdGlvbiArICdkZWcpJyk7XG5cbiAgICAgICAgICAgIGlmICggKGRhdGFZUG9zaXRpb24gPiAwICYmICgoZGF0YVogKiAxMCkgLSAoZGF0YVkgKiAxMCkpIDwgMTAwKSB8fCAoZGF0YVlQb3NpdGlvbiA8IDAgJiYgKChkYXRhWiAqIDEwKSAtIChkYXRhWSAqIDEwKSkgPiAxMDApKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZpcmVkIScpO1xuICAgICAgICAgICAgICAgICQoJyNkZWJ1Zy1hY2NlbCcpLnRleHQoJ0ZpcmVkIScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwcmV2aW91c0RhdGFZID0gZGF0YVlQb3NpdGlvbjtcblxuICAgICAgICB9KTtcbiAgICB9LFxuICAgIGFjY2VsZXJvbWV0ZXJTdG9wKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnU3RvcHBpbmcgYWNjZWxlcm9tZXRlciByZWFkaW5nJyk7XG4gICAgICAgICQoJyNkZWJ1Zy1hY2NlbCcpLnRleHQoJ0FjY2VsZXJvbWV0ZXIgU3RvcHBlZC4nKTtcbiAgICAgICAgc29ja2V0LmxvY2FsLmVtaXQoJ3N0b3BBY2NlbGVyb21ldGVyJywgdHJ1ZSk7XG4gICAgfSxcbiAgICBhY2NlbGVyb21ldGVyUGluKCkge1xuICAgICAgICBsZXQgYWNjZWwgPSAkKCcuYWNjZWwtbGluZScpLmRldGFjaCgpO1xuICAgICAgICAkKCcjcGlubmVkID4gI2FjY2VsZXJvbWV0ZXInKS5odG1sKGFjY2VsKTtcbiAgICB9LFxuICAgIC8vIHRlbnNvckZsb3dTdGFydCgpIHtcbiAgICAvLyAgICAgLy9TdGFuZGFyZCBXZWJTb2NrZXQgc3RyZWFtaW5nXG4gICAgLy8gICAgIGNvbnN0IHNvY2tldCA9IG5ldyBXZWJTb2NrZXQoJ3dzOi8vMTAuMC4xMC4xMDA6MTMzNycpO1xuICAgIC8vICAgICBjb25zdCBzdHJlYW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW1hZ2Utc3RyZWFtZXInKTtcbiAgICAvLyAgICAgY29uc3QgRlBTID0gMTtcbiAgICAgICAgXG4gICAgICAgIFxuXG4gICAgLy8gICAgIGNvbnN0IGdldEZyYW1lID0gKCkgPT4ge1xuICAgIC8vICAgICAgICAgLy9jb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICAvLyAgICAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZmNhbnZhcycpO1xuICAgIC8vICAgICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAvLyAgICAgICAgIGN0eC5kcmF3SW1hZ2Uoc3RyZWFtLCAwLCAwKTtcbiAgICAvLyAgICAgICAgIGNvbnN0IGRhdGEgPSBjYW52YXMudG9EYXRhVVJMKCdkYXRhOmltYWdlL2pwZWc7Y2hhcnNldD11dGYtODtiYXNlNjQsJywgMC4xKTtcbiAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgIC8vICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgLy8gICAgIH1cbiAgICAgICAgXG4gICAgLy8gICAgIHNvY2tldC5vbm9wZW4gPSAoKSA9PiB7XG4gICAgLy8gICAgICAgICB0ZW5zb3JGbG93ID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgIC8vICAgICAgICAgICAgIHNvY2tldC5iaW5hcnlUeXBlID0gXCJhcnJheWJ1ZmZlclwiO1xuICAgIC8vICAgICAgICAgICAgIHNvY2tldC5zZW5kKGdldEZyYW1lKCkpO1xuICAgIC8vICAgICAgICAgfSwgMTAwMCAvIEZQUyk7XG4gICAgLy8gICAgIH1cblxuICAgIC8vICAgICBzb2NrZXQub25tZXNzYWdlID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAvLyAgICAgICAgIGxldCB0ZmRhdGEgPSBKU09OLnBhcnNlKG1lc3NhZ2UuZGF0YSk7XG4gICAgLy8gICAgICAgICBjb25zb2xlLmxvZyh0ZmRhdGFbMF0uY2xhc3MpO1xuICAgIC8vICAgICAgICAgJCgnI2RlYnVnLWFpJykudGV4dCh0ZmRhdGFbMF0uY2xhc3MpO1xuICAgIC8vICAgICB9O1xuXG4gICAgLy8gICAgIHNvY2tldC5vbmVycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgLy8gICAgICAgICBjb25zb2xlLmxvZygnV2ViU29ja2V0IGVycm9yOiAnICsgZXJyb3IpO1xuICAgIC8vICAgICB9O1xuXG4gICAgLy8gfSxcbiAgICB0ZW5zb3JGbG93U3RhcnQoKSB7XG4gICAgICAgIC8vU29ja2V0LmlvIFN0cmVhbWluZ1xuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgICAgIGNvbnN0IEZQUyA9IDE7XG5cbiAgICAgICAkKCcjZGVidWctYWknKS50ZXh0KCdBSSBTdGFydGVkLi4uJyk7XG4gICAgICAgIFxuXG4gICAgICAgIGNvbnN0IGdldEZyYW1lID0gKCkgPT4ge1xuICAgICAgICAgICByZXR1cm4gc2VsZi5jb252ZXJ0VG9CYXNlNjQoKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIHRlbnNvckZsb3cgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgICAvL3NvY2tldC5iaW5hcnlUeXBlID0gXCJhcnJheWJ1ZmZlclwiO1xuICAgICAgICAgICAgc29ja2V0LnNlcnZlci5lbWl0KCdzdHJlYW0nLCBnZXRGcmFtZSgpKTtcbiAgICAgICAgfSwgMTAwMCAvIEZQUyk7XG4gICAgICAgIFxuXG4gICAgICAgIC8vIHNvY2tldC5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICAvLyAgICAgbGV0IHRmZGF0YSA9IEpTT04ucGFyc2UobWVzc2FnZS5kYXRhKTtcbiAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKHRmZGF0YVswXS5jbGFzcyk7XG4gICAgICAgIC8vICAgICAkKCcjZGVidWctYWknKS50ZXh0KHRmZGF0YVswXS5jbGFzcyk7XG4gICAgICAgIC8vIH07XG5cbiAgICAgICAgc29ja2V0LnNlcnZlci5vbignQUlJZGVudGlmaWVkJywgKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgICAgICAgbGV0IGxlZnQgPSBkYXRhWzBdLmJib3hbMF07XG4gICAgICAgICAgICBsZXQgdG9wID0gZGF0YVswXS5iYm94WzFdO1xuICAgICAgICAgICAgbGV0IHdpZHRoID0gZGF0YVswXS5iYm94WzJdO1xuICAgICAgICAgICAgbGV0IGhlaWdodCA9IGRhdGFbMF0uYmJveFszXTtcbiAgICAgICAgICAgIGxldCBvYmpDbGFzcyA9IGRhdGFbMF0uY2xhc3M7XG4gICAgICAgICAgICBsZXQgc2NvcmUgPSBkYXRhWzBdLnNjb3JlO1xuXG4gICAgICAgICAgICAkKCcjZGVidWctYWknKS50ZXh0KG9iakNsYXNzICsgJyAtLS0gJyArIE1hdGgucm91bmQoMTAwICogc2NvcmUpICsgJyUnKTtcbiAgICAgICAgICAgICQoJyNURlRhcmdldCcpLmNzcyh7XG4gICAgICAgICAgICAgICAgJ3RvcCc6IHRvcCxcbiAgICAgICAgICAgICAgICAnbGVmdCc6IGxlZnQsXG4gICAgICAgICAgICAgICAgJ2hlaWdodCc6IGhlaWdodCxcbiAgICAgICAgICAgICAgICAnd2lkdGgnOiB3aWR0aFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHNvY2tldC5vbmVycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgIC8vICAgICBjb25zb2xlLmxvZygnV2ViU29ja2V0IGVycm9yOiAnICsgZXJyb3IpO1xuICAgICAgICAvLyB9O1xuXG4gICAgfSxcbiAgICB0ZW5zb3JGbG93U3RvcCgpIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbCh0ZW5zb3JGbG93KTtcbiAgICAgICAgJCgnI2RlYnVnLWFpJykudGV4dCgnQUkgU3RvcHBlZCcpO1xuICAgICAgICBjb25zb2xlLmxvZygndGVzdCcpO1xuICAgIH0sXG4gICAgdHJhY2tBbmRSZW5kZXJMb2NhbCgpIHtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB4bWluID0gMjAwO1xuICAgICAgICBjb25zdCB5bWluID0gMjAwO1xuICAgICAgICBjb25zdCB3aWR0aCA9IDIwMDtcbiAgICAgICAgY29uc3QgaGVpZ2h0ID0gMjAwO1xuXG4gICAgICAgIGNvbnN0IGZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0cmVhbScpO1xuXG4gICAgICAgIHNlbGYucmVuZGVyQm94KFt4bWluLCB5bWluLCB3aWR0aCwgaGVpZ2h0XSk7XG5cbiAgICAgICAgY29uc3QgdHJhY2tlciA9IG9iamVjdFRyYWNrZXIuaW5pdChmcmFtZSwgW1xuICAgICAgICAgICAgeG1pbixcbiAgICAgICAgICAgIHltaW4sXG4gICAgICAgICAgICB3aWR0aCxcbiAgICAgICAgICAgIGhlaWdodFxuICAgICAgICBdKTtcblxuICAgICAgICBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7XG5cbiAgICAgICAgICAgIGxldCBmcmFtZTIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RyZWFtJyk7XG4gICAgICAgICAgICBsZXQgYm94MiA9IGF3YWl0IHRyYWNrZXIubmV4dChmcmFtZTIpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYm94Mik7XG4gICAgICAgICAgICBtZnNiLnJlbmRlckJveChib3gyKTtcbiAgICAgICAgfSwxMDApO1xuXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHRyYWNrZXIpO1xuXG4gICAgICAgIC8vICAgICBhc3luYyB0cmFja2VyID0+IHtcbiAgICAgICAgLy8gICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFzeW5jICgpID0+IHtcbiAgICAgICAgLy8gICAgICAgICBjb25zdCBib3ggPSBhd2FpdCB0cmFja2VyLm5leHQoZnJhbWUpO1xuICAgICAgICAvLyAgICAgICAgIHJlbmRlckJveChib3gpO1xuICAgICAgICAvLyAgICAgICAgIHRyYWNrQW5kUmVuZGVyKHRyYWNrZXIpO1xuICAgICAgICAvLyAgICAgICB9KTtcbiAgICAgICAgLy8gICAgIH0sXG4gICAgICAgIC8vICAgICBjb25zb2xlLmxvZygnRm91bmQuLi4nKVxuXG4gICAgfSxcbiAgICB0cmFja0FuZFJlbmRlckxvY2FsQWpheCgpIHtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB4bWluID0gMjAwO1xuICAgICAgICBjb25zdCB5bWluID0gMjAwO1xuICAgICAgICBjb25zdCB3aWR0aCA9IDIwMDtcbiAgICAgICAgY29uc3QgaGVpZ2h0ID0gMjAwO1xuXG4gICAgICAgIGNvbnN0IGZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0cmVhbScpO1xuXG4gICAgICAgIHNlbGYucmVuZGVyQm94KFt4bWluLCB5bWluLCB3aWR0aCwgaGVpZ2h0XSk7XG5cbiAgICAgICAgY29uc3QgdHJhY2tlciA9IG9iamVjdFRyYWNrZXIuaW5pdChmcmFtZSwgW1xuICAgICAgICAgICAgeG1pbixcbiAgICAgICAgICAgIHltaW4sXG4gICAgICAgICAgICB3aWR0aCxcbiAgICAgICAgICAgIGhlaWdodFxuICAgICAgICBdKTtcblxuICAgICAgICBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7XG5cbiAgICAgICAgICAgIGxldCBmcmFtZTIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RyZWFtJyk7XG4gICAgICAgICAgICBsZXQgYm94MiA9IGF3YWl0IHRyYWNrZXIubmV4dChmcmFtZTIpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYm94Mik7XG4gICAgICAgICAgICBtZnNiLnJlbmRlckJveChib3gyKTtcbiAgICAgICAgfSwxMDApO1xuXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHRyYWNrZXIpO1xuXG4gICAgICAgIC8vICAgICBhc3luYyB0cmFja2VyID0+IHtcbiAgICAgICAgLy8gICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFzeW5jICgpID0+IHtcbiAgICAgICAgLy8gICAgICAgICBjb25zdCBib3ggPSBhd2FpdCB0cmFja2VyLm5leHQoZnJhbWUpO1xuICAgICAgICAvLyAgICAgICAgIHJlbmRlckJveChib3gpO1xuICAgICAgICAvLyAgICAgICAgIHRyYWNrQW5kUmVuZGVyKHRyYWNrZXIpO1xuICAgICAgICAvLyAgICAgICB9KTtcbiAgICAgICAgLy8gICAgIH0sXG4gICAgICAgIC8vICAgICBjb25zb2xlLmxvZygnRm91bmQuLi4nKVxuXG4gICAgfSxcbiAgICB0cmFja0FuZFJlbmRlckxvY2FsV29ya2VyKCkge1xuICAgICAgICAvLyBjb25zdCBzZWxmID0gdGhpcztcbiAgICAgICAgLy8gYmFzZTY0Q2FudmFzLndpZHRoID0gc3RyZWFtLndpZHRoO1xuICAgICAgICAvLyBiYXNlNjRDYW52YXMuaGVpZ2h0ID0gc3RyZWFtLmhlaWdodDtcblxuICAgICAgICAvLyBjb25zdCBjdHggPSBiYXNlNjRDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcblxuICAgICAgICAvLyBjdHguZHJhd0ltYWdlKHN0cmVhbSwgMCwgMCk7XG5cblxuICAgICAgICAvL3NvY2tldC5sb2NhbC5lbWl0KCd0cmFjaycsIGJhc2U2NENhbnZhcyk7XG4gICAgICAgIFxuXG4gICAgICAgIGNvbnN0IHhtaW4gPSAyMDA7XG4gICAgICAgIGNvbnN0IHltaW4gPSAyMDA7XG4gICAgICAgIGNvbnN0IHdpZHRoID0gMjAwO1xuICAgICAgICBjb25zdCBoZWlnaHQgPSAyMDA7XG5cbiAgICAgICAgY29uc3QgZnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RyZWFtJyk7XG4gICAgICAgIC8vbWZzYi5jb252ZXJ0SW1hZ2VUb0NhbnZhcygpO1xuXG4gICAgICAgIFxuXG4gICAgICAgIGNvbnN0IHRyYWNrZXIgPSBvYmplY3RUcmFja2VyLmluaXQoZnJhbWUsIFtcbiAgICAgICAgICAgIHhtaW4sXG4gICAgICAgICAgICB5bWluLFxuICAgICAgICAgICAgd2lkdGgsXG4gICAgICAgICAgICBoZWlnaHRcbiAgICAgICAgXSk7XG4gICAgICAgIFxuICAgICAgICBzb2NrZXQubG9jYWwuZW1pdCgndHJhY2snLCB0cmFja2VyKTtcblxuICAgICAgICAvLyBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7XG5cbiAgICAgICAgLy8gICAgIGxldCBmcmFtZTIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RyZWFtJyk7XG4gICAgICAgIC8vICAgICBsZXQgYm94MiA9IGF3YWl0IHRyYWNrZXIubmV4dChmcmFtZTIpO1xuICAgICAgICAvLyAgICAgY29uc29sZS5sb2coYm94Mik7XG4gICAgICAgIC8vICAgICBtZnNiLnJlbmRlckJveChib3gyKTtcbiAgICAgICAgLy8gfSwxMDApO1xuXG4gICAgICAgIC8vc29ja2V0LmxvY2FsLmVtaXQoJ3RyYWNrJywgYmFzZTY0Q2FudmFzKTtcblxuICAgICAgICAvLyBjb25zb2xlLmxvZyh0cmFja2VyKTtcblxuICAgICAgICAvLyBsZXQgc3RyZWFtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0cmVhbScpO1xuICAgICAgICAvLyBsZXQgaW1nID0gbWZzYi5jb252ZXJ0VG9CYXNlNjQoKTtcbiAgICAgICAgLy8gLy8gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICAvLyAgICAgLy93b3JrZXIucG9zdE1lc3NhZ2UoaW1nKTtcbiAgICAgICAgLy8gLy8gfSwxMDApXG4gICAgICAgIC8vIHdvcmtlci5wb3N0TWVzc2FnZShpbWcpO1xuICAgICAgICAvLyB3b3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKGUpO1xuXG4gICAgICAgIC8vICAgfSwgZmFsc2UpO1xuICAgIH0sXG4gICAgdHJhY2tBbmRSZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgICAgICBjb25zdCBGUFMgPSAyO1xuXG4gICAgICAgIC8vY2VudGVyXG4gICAgICAgIGNvbnN0IHhtaW4gPSAxODA7XG4gICAgICAgIGNvbnN0IHltaW4gPSAxODA7XG4gICAgICAgIGNvbnN0IHdpZHRoID0gMTIwO1xuICAgICAgICBjb25zdCBoZWlnaHQgPSAxMjA7XG5cbiAgICAgICAgc2VsZi5yZW5kZXJCb3goW3htaW4sIHltaW4sIHdpZHRoLCBoZWlnaHRdKTtcblxuICAgICAgICBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgaW1nID0gYXdhaXQgc2VsZi5jb252ZXJ0VG9CYXNlNjQoKTtcblxuICAgICAgICAgICAgbGV0IHRvZGF5ID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgIGxldCBub3cgPSB0b2RheS5nZXRIb3VycygpICsgXCI6XCIgKyB0b2RheS5nZXRNaW51dGVzKCkgKyBcIjpcIiArIHRvZGF5LmdldFNlY29uZHMoKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbJyArIG5vdyArICddJyArICdJbWFnZSBjb252ZXJ0ZWQuLi4gc2VuZGluZy4nICk7XG4gICAgICAgICAgICBhd2FpdCBzb2NrZXQuc2VydmVyLmVtaXQoJ3RyYWNrJywgaW1nKTtcbiAgICAgICAgfSwgMCk7XG5cbiAgICAgICAgLy9zb2NrZXQuZW1pdCgndHJhY2snLCBzZWxmLmNvbnZlcnRUb0Jhc2U2NCgpKTtcblxuICAgICAgICBzb2NrZXQuc2VydmVyLm9uKCdvYmplY3RUcmFja2VyJywgKHRyYWNrZXIpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyQm94KHRyYWNrZXIpO1xuICAgICAgICB9KTtcbiAgICB9LFxuICAgIGxvY2tUYXJnZXQoKSB7XG4gICAgICAgIGxldCBzZWxmID0gdGhpcztcbiAgICAgICAgY29uc3QgeG1pbiA9IDE4MDtcbiAgICAgICAgY29uc3QgeW1pbiA9IDE4MDtcbiAgICAgICAgY29uc3Qgd2lkdGggPSAxMjA7XG4gICAgICAgIGNvbnN0IGhlaWdodCA9IDEyMDtcblxuICAgICAgICBzb2NrZXQuc2VydmVyLmVtaXQoJ2xvY2stdGFyZ2V0JywgW3htaW4sIHltaW4sIHdpZHRoLCBoZWlnaHRdKTtcbiAgICAgICAgc29ja2V0LnNlcnZlci5lbWl0KCdsb2NrLXRhcmdldC1wcm9maWxlJywgc2VsZi5jb252ZXJ0VG9CYXNlNjQoKSk7XG5cbiAgICAgICAgc2VsZi5yZW5kZXJCb3goW3htaW4sIHltaW4sIHdpZHRoLCBoZWlnaHRdKTtcbiAgICB9LFxuICAgIHJlbmRlckJveChib3gpIHtcbiAgICAgICAgdHJhY2tpbmdDYW52YXMud2lkdGggPSA0ODA7XG4gICAgICAgIHRyYWNraW5nQ2FudmFzLmhlaWdodCA9IDQ4MDtcbiAgICAgICAgbGV0IGN0eCA9IHRyYWNraW5nQ2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgY3R4LmNhbnZhcy53aWR0aCwgY3R4LmNhbnZhcy5oZWlnaHQpO1xuICAgICAgICBjdHgubGluZVdpZHRoID0gMjtcbiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gXCJ5ZWxsb3dcIjtcbiAgICAgICAgY3R4LnN0cm9rZVJlY3QoYm94WzBdLCBib3hbMV0sIGJveFsyXSwgYm94WzNdKTtcblxuICAgIH0sXG4gICAgY29udmVydEltYWdlVG9DYW52YXMoKSB7XG4gICAgICAgIGJhc2U2NENhbnZhcy53aWR0aCA9IHN0cmVhbS53aWR0aDtcbiAgICAgICAgYmFzZTY0Q2FudmFzLmhlaWdodCA9IHN0cmVhbS5oZWlnaHQ7XG5cbiAgICAgICAgY29uc3QgY3R4ID0gYmFzZTY0Q2FudmFzLmdldENvbnRleHQoJzJkJyk7XG5cbiAgICAgICAgY3R4LmRyYXdJbWFnZShzdHJlYW0sIDAsIDApO1xuXG4gICAgICAgIHJldHVybiBjdHg7XG4gICAgfSxcbiAgICBjb252ZXJ0VG9CYXNlNjQoKSB7XG4gICAgICAgIFxuICAgICAgICBiYXNlNjRDYW52YXMud2lkdGggPSBzdHJlYW0ud2lkdGg7XG4gICAgICAgIGJhc2U2NENhbnZhcy5oZWlnaHQgPSBzdHJlYW0uaGVpZ2h0O1xuXG4gICAgICAgIGNvbnN0IGN0eCA9IGJhc2U2NENhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuXG4gICAgICAgIGN0eC5kcmF3SW1hZ2Uoc3RyZWFtLCAwLCAwKTtcblxuICAgICAgICBjb25zdCBkYXRhID0gYmFzZTY0Q2FudmFzLnRvRGF0YVVSTCgnZGF0YTppbWFnZS9qcGc7Y2hhcnNldD11dGYtODtiYXNlNjQsJywgMC4xKTtcblxuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICB9LFxuICAgIHN1ZG9SZWJvb3QoKSB7XG5cbiAgICAgICAgc29ja2V0LmxvY2FsLmVtaXQoJ3N1ZG9SZWJvb3QnLCB0cnVlKTtcbiAgICB9LFxuICAgIHN1ZG9TaHV0ZG93bigpIHtcbiAgICAgICAgc29ja2V0LmxvY2FsLmVtaXQoJ3N1ZG9TaHV0ZG93bicsIHRydWUpO1xuICAgIH0sXG5cbn0iXSwiZmlsZSI6InNjcmlwdHMubWluLmpzIn0=
